<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Fabric Camera</title>

<style>
/* ===== iPhone Camera Look ===== */
:root{
  --bg:#000;
  --panel:rgba(20,20,20,.9);
  --yellow:#facc15;
  --white:#fff;
  --gray:#9ca3af;
}

*{box-sizing:border-box}

body{
  margin:0;
  background:var(--bg);
  font-family:-apple-system,BlinkMacSystemFont,"SF Pro Display",system-ui;
  color:var(--white);
  overflow:hidden;
}

.app{
  max-width:430px;
  height:100vh;
  margin:auto;
  display:flex;
  flex-direction:column;
}

/* ===== Camera View ===== */
.camera{
  flex:1;
  position:relative;
  background:#000;
}

video{
  width:100%;
  height:100%;
  object-fit:cover;
}

/* ===== Top Controls ===== */
.topbar{
  position:absolute;
  top:12px;
  width:100%;
  display:flex;
  justify-content:space-between;
  padding:0 16px;
  z-index:5;
}

.icon-btn{
  width:36px;
  height:36px;
  border-radius:50%;
  border:none;
  background:rgba(0,0,0,.5);
  color:#fff;
  font-size:16px;
}

/* ===== Manual Controls Strip ===== */
.manual{
  position:absolute;
  bottom:120px;
  width:100%;
  display:flex;
  justify-content:space-around;
  z-index:5;
}

.manual div{
  background:rgba(0,0,0,.6);
  padding:6px 10px;
  border-radius:10px;
  text-align:center;
  font-size:11px;
}

.manual span{
  display:block;
  color:var(--yellow);
  font-weight:600;
}

/* ===== Bottom Camera Bar ===== */
.bottombar{
  height:120px;
  background:var(--panel);
  backdrop-filter:blur(20px);
  display:flex;
  align-items:center;
  justify-content:space-around;
}

.thumb{
  width:48px;
  height:48px;
  border-radius:10px;
  background:#333;
}

.shutter{
  width:74px;
  height:74px;
  border-radius:50%;
  background:#fff;
  border:6px solid #d1d5db;
}

.mode{
  font-size:12px;
  color:var(--gray);
}

/* ===== Form Sheet ===== */
.form{
  position:absolute;
  bottom:0;
  width:100%;
  background:#111;
  padding:14px;
  transform:translateY(100%);
  transition:.3s;
  z-index:10;
}

.form.show{transform:translateY(0)}

input{
  width:100%;
  padding:12px;
  margin-top:10px;
  border-radius:10px;
  border:none;
  background:#1f1f1f;
  color:#fff;
}

button.save{
  margin-top:14px;
  width:100%;
  padding:14px;
  border:none;
  border-radius:14px;
  background:var(--yellow);
  font-weight:600;
  font-size:16px;
}

button.secondary{
  margin-top:10px;
  width:100%;
  padding:12px;
  border:none;
  border-radius:12px;
  background:#374151;
  color:#fff;
}

/* ===== Loader ===== */
.loader{
  text-align:center;
  font-size:13px;
  margin-top:8px;
  display:none;
}
</style>
</head>

<body>

<div class="app">

  <div class="camera">
    <video id="video" autoplay playsinline></video>

    <!-- Top Bar -->
    <div class="topbar">
      <button class="icon-btn">âš¡</button>
      <button class="icon-btn" onclick="switchCamera()">ðŸ”„</button>
    </div>

    <!-- Manual Controls -->
    <div class="manual">
      <div>ISO<span id="iso">Auto</span></div>
      <div>WB<span id="wb">Auto</span></div>
      <div>EV<span id="ev">0.0</span></div>
      <div>Focus<span id="focus">Auto</span></div>
    </div>
  </div>

  <!-- Bottom Camera Bar -->
  <div class="bottombar">
    <div class="thumb"></div>
    <div class="shutter" onclick="capture()"></div>
    <div class="mode">PHOTO</div>
  </div>

  <!-- Form Sheet -->
  <div class="form" id="form">
    <input id="fabricName" placeholder="Fabric Name">
    <input id="category" placeholder="Category (Cotton / Rib)">
    <input id="gsm" placeholder="GSM">
    <input id="color" placeholder="Color">
    <input id="party" placeholder="Party">
    <input id="notes" placeholder="Notes">

    <button class="save" onclick="upload()">Save to Drive</button>
    <button class="secondary" onclick="retake()">Retake</button>
    <div class="loader" id="loader">Uploadingâ€¦</div>
  </div>

</div>

<script>
/* ===== CONFIG ===== */
const API_URL = "https://script.google.com/macros/s/AKfycbzvAJxqfHkqYHGMVa4t42Ghoa7l8wQQdkIdPB2rmKDn4YkxnxiqMlE_LEDhwzEVasWg/exec";

const video = document.getElementById("video");
const canvas = document.createElement("canvas");
const form = document.getElementById("form");
const loader = document.getElementById("loader");

let stream;
let facing = "environment";
let imageBase64 = "";

/* ===== Camera Init ===== */
async function startCamera(){
  if(stream) stream.getTracks().forEach(t=>t.stop());
  stream = await navigator.mediaDevices.getUserMedia({
    video:{facingMode:{ideal:facing}}
  });
  video.srcObject = stream;
}
startCamera();

/* ===== Switch Camera ===== */
function switchCamera(){
  facing = facing === "environment" ? "user" : "environment";
  startCamera();
}

/* ===== Capture ===== */
function capture(){
  canvas.width = video.videoWidth;
  canvas.height = video.videoHeight;
  canvas.getContext("2d").drawImage(video,0,0);
  imageBase64 = canvas.toDataURL("image/jpeg",0.9).split(",")[1];
  form.classList.add("show");
}

/* ===== Retake ===== */
function retake(){
  form.classList.remove("show");
  imageBase64 = "";
}

/* ===== Upload ===== */
async function upload(){
  if(!imageBase64){
    alert("Capture image first");
    return;
  }

  loader.style.display="block";

  const payload = {
    imageBase64,
    fabricName: fabricName.value,
    category: category.value,
    gsm: gsm.value,
    color: color.value,
    party: party.value,
    notes: notes.value
  };

  try{
    const res = await fetch(API_URL,{
      method:"POST",
      body:JSON.stringify(payload)
    });
    const json = await res.json();
    loader.style.display="none";

    if(json.success){
      alert("Saved âœ…");
      location.reload();
    }else{
      alert(json.error || "Upload failed");
    }
  }catch(err){
    loader.style.display="none";
    alert("Network error");
  }
}
</script>

</body>
</html>
