<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport"
content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">

<title>Fabric Pro Camera</title>

<style>
:root{
  --bg:#000;
  --panel:rgba(20,20,20,.92);
  --yellow:#facc15;
  --white:#fff;
}

*{box-sizing:border-box}

body{
  margin:0;
  background:#000;
  font-family:-apple-system,BlinkMacSystemFont,system-ui;
  color:#fff;
  overflow:hidden;
}

.app{
  position:relative;
  height:100svh;
  max-width:430px;
  margin:auto;
  background:#000;
}

/* CAMERA */
video{
  position:absolute;
  inset:0;
  width:100%;
  height:100%;
  object-fit:cover;
}

/* TOP BAR */
.topbar{
  position:absolute;
  top:12px;
  left:0;
  right:0;
  display:flex;
  justify-content:space-between;
  padding:0 16px;
  z-index:10;
}

.icon{
  background:rgba(0,0,0,.55);
  border:none;
  color:#fff;
  width:36px;
  height:36px;
  border-radius:50%;
  font-size:16px;
}

/* ZOOM */
.zoom{
  position:absolute;
  bottom:160px;
  left:50%;
  transform:translateX(-50%);
  display:flex;
  gap:10px;
  z-index:10;
}

.zoom button{
  background:rgba(0,0,0,.6);
  border:none;
  color:#fff;
  padding:6px 12px;
  border-radius:20px;
}

/* MANUAL STRIP */
.manual{
  position:absolute;
  bottom:120px;
  left:0;
  right:0;
  display:flex;
  justify-content:space-around;
  font-size:11px;
  z-index:10;
}

.manual span{
  color:var(--yellow);
}

/* BOTTOM BAR */
.bottom{
  position:absolute;
  bottom:env(safe-area-inset-bottom);
  left:0;
  right:0;
  height:120px;
  background:var(--panel);
  display:flex;
  align-items:center;
  justify-content:center;
  z-index:20;
}

.shutter{
  width:76px;
  height:76px;
  border-radius:50%;
  background:#fff;
  border:6px solid #d1d5db;
}

/* FORM */
.form{
  position:absolute;
  bottom:0;
  left:0;
  right:0;
  background:#111;
  padding:14px;
  transform:translateY(100%);
  transition:.3s;
  z-index:30;
}

.form.show{transform:translateY(0)}

input{
  width:100%;
  padding:12px;
  margin-top:10px;
  border-radius:10px;
  border:none;
  background:#1f1f1f;
  color:#fff;
}

.save{
  margin-top:14px;
  width:100%;
  padding:14px;
  background:var(--yellow);
  border:none;
  border-radius:14px;
  font-weight:600;
}
</style>
</head>

<body>

<div class="app">

<video id="video" autoplay playsinline></video>

<div class="topbar">
  <button class="icon" onclick="toggleFocus()">ðŸŽ¯</button>
  <button class="icon" onclick="switchCamera()">ðŸ”„</button>
</div>

<div class="manual">
  <div>AF <span id="af">ON</span></div>
  <div>EV <span id="ev">0</span></div>
  <div>Zoom <span id="zoomLabel">1x</span></div>
</div>

<div class="zoom">
  <button onclick="setZoom(1)">1Ã—</button>
  <button onclick="setZoom(2)">2Ã—</button>
</div>

<div class="bottom">
  <div class="shutter" onclick="capture()"></div>
</div>

<div class="form" id="form">
  <input id="fabricName" placeholder="Fabric Name">
  <input id="category" placeholder="Category">
  <input id="gsm" placeholder="GSM">
  <input id="color" placeholder="Color">
  <button class="save" onclick="upload()">Save</button>
</div>

</div>

<script>
const API =
"https://script.google.com/macros/s/AKfycbzvAJxqfHkqYHGMVa4t42Ghoa7l8wQQdkIdPB2rmKDn4YkxnxiqMlE_LEDhwzEVasWg/exec";

const video=document.getElementById("video");
const canvas=document.createElement("canvas");
const form=document.getElementById("form");

let stream,track;
let facing="environment";
let af=true;
let zoom=1;

/* START CAMERA */
async function start(){
  if(stream) stream.getTracks().forEach(t=>t.stop());

  stream=await navigator.mediaDevices.getUserMedia({
    video:{facingMode:{ideal:facing}}
  });

  video.srcObject=stream;
  track=stream.getVideoTracks()[0];
}
start();

/* CAMERA SWITCH */
function switchCamera(){
  facing=facing==="environment"?"user":"environment";
  start();
}

/* AUTOFOCUS TOGGLE (REAL) */
function toggleFocus(){
  af=!af;
  track.applyConstraints({
    advanced:[{focusMode:af?"continuous":"manual"}]
  });
  afLabel.textContent=af?"ON":"OFF";
}

/* ZOOM (REAL) */
function setZoom(z){
  zoom=z;
  track.applyConstraints({advanced:[{zoom:z}]});
  zoomLabel.textContent=z+"x";
}

/* CAPTURE */
function capture(){
  canvas.width=video.videoWidth;
  canvas.height=video.videoHeight;
  canvas.getContext("2d").drawImage(video,0,0);
  imageBase64=canvas.toDataURL("image/jpeg",0.9).split(",")[1];
  form.classList.add("show");
}

/* UPLOAD */
async function upload(){
  await fetch(API,{
    method:"POST",
    body:JSON.stringify({
      imageBase64,
      fabricName:fabricName.value,
      category:category.value,
      gsm:gsm.value,
      color:color.value
    })
  });
  location.reload();
}
</script>

</body>
</html>
